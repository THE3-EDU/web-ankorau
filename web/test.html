<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Transparent Center Button</title>
  <style>
    /* 让页面透明 */
    :root, html, body {
      height: 100%;
      margin: 0;
      background: transparent;
    }

    /* 整页居中布局 */
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      /* 如果你希望页面在直接打开时有轻微半透明背景，取消下面一行注释并调整 rgba 值 */
      /* background-color: rgba(255,255,255,0.02); */
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    /* 按钮样式（简洁且有轻微阴影）*/
    .center-button {
      -webkit-appearance: none;
      appearance: none;
      border: 0;
      padding: 50px 100px;
      font-size: 24px;
      border-radius: 20px;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,0.18);
      background: #ffffff;
      color: #fff;
      backdrop-filter: blur(6px); /* 需要在支持的环境中才会模糊背后内容 */
      transition: transform .12s ease, box-shadow .12s ease, opacity .12s;
      user-select: none;
    }

    .center-button:active { transform: translateY(2px); }
    .center-button:focus { outline: 2px solid rgba(255,255,255,0.12); outline-offset: 2px; }

    .center-button.clicked {
      background: #ff7a18;
      color: #111;
      box-shadow: 0 8px 22px rgba(255,122,24,0.45);
    }

    /* 可选：在深色/浅色背景下调整文字颜色 */
    @media (prefers-color-scheme: light) {
      .center-button { color: #111; box-shadow: 0 6px 18px rgba(0,0,0,0.12); }
    }

    /* WebSocket 状态指示器 */
    .ws-status {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
      padding: 8px 16px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(6px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      font-size: 14px;
      user-select: none;
    }

    .ws-status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      transition: background-color 0.3s ease;
    }

    .ws-status-dot.connecting {
      background-color: #ffa500;
      animation: pulse 1.5s ease-in-out infinite;
    }

    .ws-status-dot.connected {
      background-color: #4caf50;
    }

    .ws-status-dot.disconnected {
      background-color: #f44336;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>
</head>
<body>
  <div class="ws-status" id="wsStatus">
    <span class="ws-status-dot" id="wsStatusDot"></span>
    <span id="wsStatusText">连接中...</span>
  </div>
  <button class="center-button" id="mainBtn">点击我</button>

  <script>
    const btn = document.getElementById('mainBtn');
    const wsStatusDot = document.getElementById('wsStatusDot');
    const wsStatusText = document.getElementById('wsStatusText');
    
    // WebSocket 连接
    let ws = null;
    const wsUrl = 'ws://localhost:9980';
    
    // 更新连接状态显示
    function updateConnectionStatus(status, text) {
      wsStatusDot.className = 'ws-status-dot ' + status;
      wsStatusText.textContent = text;
    }
    
    // 初始化 WebSocket 连接
    function initWebSocket() {
      try {
        updateConnectionStatus('connecting', '连接中...');
        ws = new WebSocket(wsUrl);
        
        ws.onopen = () => {
          console.log('WebSocket 连接已建立');
          updateConnectionStatus('connected', '已连接');
          btn.textContent = '点击我';
        };
        
        ws.onerror = (error) => {
          console.error('WebSocket 错误:', error);
          updateConnectionStatus('disconnected', '连接错误');
          btn.textContent = '点击我';
        };
        
        ws.onclose = () => {
          console.log('WebSocket 连接已关闭');
          updateConnectionStatus('disconnected', '已断开，正在重连...');
          btn.textContent = '点击我';
          // 3秒后尝试重连
          setTimeout(initWebSocket, 3000);
        };
        
        ws.onmessage = (event) => {
          console.log('收到消息:', event.data);
        };
      } catch (error) {
        console.error('创建 WebSocket 连接失败:', error);
        updateConnectionStatus('disconnected', '连接失败');
        btn.textContent = '点击我';
      }
    }
    
    // 发送 WebSocket 消息
    function sendWebSocketMessage() {
      if (ws && ws.readyState === WebSocket.OPEN) {
        const message = JSON.stringify({
          type: 'button_click',
          timestamp: new Date().toISOString(),
          message: '按钮被点击了'
        });
        ws.send(message);
        console.log('已发送消息:', message);
      } else {
        console.warn('WebSocket 未连接，尝试重新连接...');
        initWebSocket();
      }
    }
    
    // 按钮点击事件
    btn.addEventListener('click', () => {
      btn.classList.toggle('clicked');
      sendWebSocketMessage();
    });
    
    // 页面加载时初始化 WebSocket
    initWebSocket();
    
    // 页面卸载时关闭连接
    window.addEventListener('beforeunload', () => {
      if (ws) {
        ws.close();
      }
    });

    // 如果需要通过 JS 切换透明/不透明，可以如下控制：
    // document.body.style.background = 'transparent'; // 保持透明
    // document.body.style.background = 'rgba(0,0,0,0.25)'; // 半透明遮罩
  </script>
</body>
</html>